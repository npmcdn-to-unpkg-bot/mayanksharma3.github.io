<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>IDE</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'>
</head>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    var socket = io('http://localhost:8080');
    var id = location.href;
    id = id.split('?')[1];
    $(window).load(function(e) {
        $('#result').attr('src', 'app/index.html?' + id);
    });
    $(document).delegate('textarea', 'keydown', function(e) {
        var keyCode = e.keyCode || e.which;

        if (keyCode == 9) {
            e.preventDefault();
            var start = $(this).get(0).selectionStart;
            var end = $(this).get(0).selectionEnd;
            $(this).val($(this).val().substring(0, start) +
                ' ' +
                $(this).val().substring(end));
            $(this).get(0).selectionStart =
                $(this).get(0).selectionEnd = start + 1;
        }
    });

    function changed() {
        var log1 = document.querySelector('#log');
        ['log', 'warn', 'error'].forEach(function(verb) {
            console[verb] = (function(method, verb, log1) {
                return function(text) {
                    method(text);
                    var msg = document.createElement('code');
                    msg.classList.add(verb);
                    msg.textContent = verb + ': ' + text;
                    log1.appendChild(msg);
                };
            })(console[verb].bind(console), verb, log1);
        });
        var html = $('#html').val();
        html = html.replace(/</g, "\x3C");
        var css = '\<style\>' + $('#css').val() + '\</style\>';
        var js = '\<script\>' + ($('#js').val()) + '\</script\>';
        var result = (html) + js + css;
        socket.emit('htmlData', {
            'id': id,
            'result': result
        });
    };
</script>
<style>
    textarea {
        height: 45vh;
        font-family: 'Droid Sans Mono', sans-serif;
        background-color: #282c35;
        color: #FFF;
    }
    
    body {
        height: 100%;
    }
</style>
<body>
    <div class="container-fluid">
        <div id="nav" style="height:5vh">
            <button class="btn btn-default" onclick="changed()">Run</button>
            <button class="btn btn-default" onclick="changed()">View Console</button>
            <button class="btn btn-default" onclick="changed()">Export Code</button>
        </div>
        <div class="row" style="height:80vh">
            <textarea id="html" class="col-lg-6 col-md-6 col-xs-12"></textarea>
            <textarea id="js" class="col-lg-6 col-md-6 col-xs-12"></textarea>
            <textarea id="css" class="col-lg-6 col-md-6 col-xs-12"></textarea>
            <iframe src="" id="result" class="col-lg-6 col-md-6 col-xs-12" style="height:45vh"></iframe>
            <div id="log" style="height:100px; width:100vw;"></div>
        </div>
    </div>
</body>
</html>